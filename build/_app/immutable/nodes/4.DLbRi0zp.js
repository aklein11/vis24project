import{U as E,D as Z,i as j,c as P,o as w,e as y,_ as $,M as k,W as U,C as R,a as L,d as _,a0 as H,N as z,b as D,P as Q,$ as G}from"../chunks/disclose-version.BWqUbDK6.js";import{a as M,p as A,A as J,k as X,g as C,h as F}from"../chunks/runtime.OLD5Tzi3.js";import{o as I,i as N}from"../chunks/main-client.Da3NpymS.js";import{u as K,a as tt,s as et}from"../chunks/store.BgVd5Zwg.js";import{w as ot,a as at,c as q,s as nt,b as rt,l as st,d as W,e as it,m as lt,f as ct,S as B,B as dt,P as ut,g as pt}from"../chunks/Piechart.UnTMsrhd.js";import{m as T}from"../chunks/Mapchoice.svelte_svelte_type_style_lang.Xqjz-iqa.js";import{w as ft}from"../chunks/index.BhXIR9a6.js";function O(r){this._context=r}O.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(r,c){switch(r=+r,c=+c,this._point){case 0:this._point=1,this._line?this._context.lineTo(r,c):this._context.moveTo(r,c);break;case 1:this._point=2;default:this._context.lineTo(r,c);break}}};function gt(r){return new O(r)}function vt(r){return r[0]}function mt(r){return r[1]}function Y(r,c){var n=q(!0),o=null,f=gt,g=null,x=ot(m);r=typeof r=="function"?r:r===void 0?vt:q(r),c=typeof c=="function"?c:c===void 0?mt:q(c);function m(s){var h,v=(s=at(s)).length,b,d=!1,t;for(o==null&&(g=f(t=x())),h=0;h<=v;++h)!(h<v&&n(b=s[h],h,s))===d&&((d=!d)?g.lineStart():g.lineEnd()),d&&g.point(+r(b,h,s),+c(b,h,s));if(t)return g=null,t+""||null}return m.x=function(s){return arguments.length?(r=typeof s=="function"?s:q(+s),m):r},m.y=function(s){return arguments.length?(c=typeof s=="function"?s:q(+s),m):c},m.defined=function(s){return arguments.length?(n=typeof s=="function"?s:q(!!s),m):n},m.curve=function(s){return arguments.length?(f=s,o!=null&&(g=f(o)),m):f},m.context=function(s){return arguments.length?(s==null?o=g=null:g=f(o=s),m):o},m}var ht=y('<h1>Condo Complaints</h1> <blockquote scrolly-container="">The <a href="https://data.boston.gov/dataset/rentsmart">RentSmart dataset</a> contains data from Boston’s 311 line and Boston’s Inspectional Services Division on residential property complaints from 2019 to the present.</blockquote> <svg id="linechart-svg" width="960" height="500"></svg>',!0);function bt(r,c){M(c,!1);let n=E(c,"query",0,""),o,f,g;function x(){const v={top:50,right:250,bottom:80,left:70},b=960-v.left-v.right,d=500-v.top-v.bottom;o=nt("#linechart-svg").attr("viewBox",`0 0 1000 ${d+v.top+v.bottom}`).append("g").attr("transform",`translate(${v.left},${v.top})`),f=rt().range([0,b]).padding(.2),o.append("g").attr("class","x-axis").attr("transform",`translate(0,${d})`),o.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",b/2).attr("y",d+40).text("Year"),g=st().range([d,0]),o.append("g").attr("class","y-axis"),o.append("text").attr("class","y label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("y",-50).attr("x",-d/2).text("Number of Distinct Buildings or Complaints in a Year"),o.append("text").attr("class","chart title").attr("x",b/2).attr("y",-20).attr("text-anchor","middle").style("font-size","20px").style("font-weight","bold").text("Complaints Filed about Condominium Buildings");const t=o.append("g").attr("class","legend").attr("transform",`translate(${b+50}, 20)`),u=[{color:"steelblue",label:"# of Complaints Filed Per Year"},{color:"red",label:"# of Distinct Buildings the Complaints are Filed About"}];let l=0;u.forEach(p=>{const a=p.label.length*8;l=Math.max(l,a)}),l+=10,t.append("rect").attr("class","legend-box").attr("x",-300).attr("y",250).attr("width",l).attr("height",u.length*20+10).attr("fill","none").attr("stroke","black"),u.forEach((p,a)=>{const e=t.append("g").attr("transform",`translate(0, ${a*20+10})`);e.append("rect").attr("x",-285).attr("y",250).attr("width",10).attr("height",10).attr("fill",p.color),e.append("text").attr("x",-270).attr("y",260).attr("font-size","15px").text(p.label)}),m(n())}async function m(h){const v=await W("complaints_year_zipcode.csv");v.columns=v.columns.map(e=>e.trim().replace(/[^\x20-\x7E]+/g,""));const b=v.filter(e=>h?e["Zip Code"]===h:!0);let d={};b.forEach(e=>{const i=e["Date (Years)"];d[i]||(d[i]={count:0,discounted:0}),d[i].count+=+e["Number of Complaints Filed Per Year"],d[i].discounted+=+e["Number of Distinct Condominum Buildings the Complaints are Filed About"]});let t=Object.keys(d).map(e=>({year:e,count:d[e].count,discounted:d[e].discounted}));const u=Y().x(e=>f(e.year)+f.bandwidth()/2).y(e=>g(e.count)),l=Y().x(e=>f(e.year)+f.bandwidth()/2).y(e=>g(e.discounted));f.domain(t.map(e=>e.year)),o.select(".x-axis").transition().duration(750).call(it(f)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end"),g.domain([0,lt(t,e=>Math.max(e.count,e.discounted))]),o.select(".y-axis").transition().duration(750).call(ct(g));let p=o.selectAll(".line-count").data([t],e=>e.year),a=o.selectAll(".line-discounted").data([t],e=>e.year);p.transition().duration(750).attr("d",u(t)),a.transition().duration(750).attr("d",l(t)),p.empty()&&o.append("path").data([t]).attr("class","line-count").attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("d",u),a.empty()&&o.append("path").data([t]).attr("class","line-discounted").attr("fill","none").attr("stroke","red").attr("stroke-width",1.5).attr("d",l)}I(()=>{x()}),Z(()=>{J(n()),X(()=>{n()&&m(n())})}),j();var s=w(r,!0,ht);P(r,s),A()}var yt=y("No zip code selected",!0),_t=y("<b> </b> <b>Click on the map to explore a different zipcode</b>",!0),xt=y('<div><div id="map" class="svelte-1spuyqf"></div> <div class="map-toolbar svelte-1spuyqf"><button class="reset-button svelte-1spuyqf">Reset Map</button> <!></div></div>');function Ct(r,c){M(c,!1),T.accessToken="pk.eyJ1Ijoic2VqYWxnIiwiYSI6ImNsdmN0Y21yZTBubmgydmxmNDlmbHVuMXAifQ.G5QWdSQskLQRC0Dw0nYLVw";let n;var o=R(null),f=E(c,"zipcode",4,null);const g=[-71.0589,42.3301],x=10;I(async()=>{n=new T.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:g,zoom:x});const t="boston-cambridge-zip-codes.geojson",u=await W("lat_long_address.csv");n.on("load",async function(){n.addSource("zip-codes",{type:"geojson",data:t}),n.addLayer({id:"polygons",type:"fill",source:"zip-codes",paint:{"fill-color":["case",["boolean",["feature-state","clicked"],!1],"#949494","#d3d3d3"],"fill-opacity":.8,"fill-outline-color":"#000000"}});const l={type:"FeatureCollection",features:u.map(a=>({type:"Feature",properties:{zipcode:a["ZIPCODE post (group)"],post_building:a["LU post groups"],prior_building:a["LU prior groups"],year_converted:a["Prior Year"],value_post:a["TOTAL VALUE post"],value_prior:a["TOTAL VALUE prior"],year_built:a["YR BUILT prior (bin) 2"],latitude:a.Latitude,longitude:a.Longitude,address:a.Address},geometry:{type:"Point",coordinates:[parseFloat(a.Longitude),parseFloat(a.Latitude)]}}))};n.addSource("locations",{type:"geojson",data:l}),n.addLayer({id:"points",type:"circle",source:"locations",paint:{"circle-radius":5,"circle-color":"#ce160e","circle-opacity":1},filter:["==",["get","zipcode"],""]});let p=null;n.on("mouseenter","points",a=>{n.getCanvas().style.cursor="pointer";const e=a.features[0].geometry.coordinates.slice(),i=a.features[0].properties;for(;Math.abs(a.lngLat.lng-e[0])>180;)e[0]+=a.lngLat.lng>e[0]?360:-360;p&&p.remove(),p=new T.Popup().setLngLat(e).setHTML(`
                        <strong>Address:</strong> ${i.address} <br>
                        <strong>Zipcode:</strong> ${i.zipcode} <br>
                        <strong>Year Built:</strong> ${parseInt(i.year_built)} <br>
                        <strong>Post Building Type:</strong> ${i.post_building} <br>
                        <strong>Prior Building Type:</strong> ${i.prior_building} <br>
                        <strong>Year Converted:</strong> ${parseInt(i.year_converted)} <br>
                        <strong>Value Prior-Conversion:</strong> $${i.value_prior.toLocaleString()} <br>
                        <strong>Value Post-Conversion:</strong> $${i.value_post.toLocaleString()} <br>
                    `).addTo(n)}),n.on("mouseleave","points",()=>{n.getCanvas().style.cursor="",p&&(p.remove(),p=null)}),n.on("click","polygons",a=>{let e=a.features[0],i=e.id;if(C(o)!==null&&C(o)!==i&&n.setFeatureState({source:"zip-codes",id:C(o)},{clicked:!1}),C(o)===i&&e.state.clicked){n.setFeatureState({source:"zip-codes",id:i},{clicked:!1}),F(o,null),n.setFilter("points",["==","id","__none__"]),n.easeTo({zoom:x,center:g});return}n.setFeatureState({source:"zip-codes",id:i},{clicked:!0}),F(o,i),f("0"+C(o).toString()),n.setFilter("points",["==",["get","zipcode"],f()]);const S=new T.LngLatBounds;e.geometry.coordinates[0].forEach(V=>{S.extend(V)}),n.fitBounds(S,{padding:20})})})});function m(){n.easeTo({zoom:x,center:g}),C(o)!==null&&n.setFeatureState({source:"zip-codes",id:C(o)},{clicked:!1}),n.setFilter("points",["==",["get","zipcode"],""]),F(o,null),f(null)}j();var s=z(r,!0,xt),h=L(s),v=_(_(h,!0)),b=L(v),d=_(_(b,!0));$("click",b,m,!1),N(d,()=>C(o)===null,t=>{var u=w(t,!0,yt);P(t,u)},t=>{var u=w(t,!0,_t),l=D(u),p=L(l);U(p,()=>`Selected zip code: ${H("0"+C(o))}`),P(t,u)}),k(r,s),A()}var kt=y('<p class="test svelte-11jnsqs">Section 1: How Old are Condos that are Most Likely to be Converted?</p>'),zt=y('<div class="scrolly-container svelte-11jnsqs"><!></div>'),Lt=y('<p class="test-pie svelte-11jnsqs">Section 2: What Types of Buildings are Most Likely to be Converted?</p>'),St=y('<div class="pie-container svelte-11jnsqs"><!></div>'),qt=y("<h1>Condo Complaints</h1> <blockquote>For Cambridge, we did not have data on condominium complaints.</blockquote>",!0),Pt=y('<p class="test svelte-11jnsqs">Section 3: How do Complaints about Condominiums vary over Time?</p>'),wt=y('<div class="scrolly-container svelte-11jnsqs"><!></div>'),Bt=y('<p class="test svelte-11jnsqs">Section 4: What Types of Complaints are Most Common?</p>'),Tt=y('<div class="scrolly-container svelte-11jnsqs"><!></div>'),Ft=y("<!> <!>",!0),Dt=y('<blockquote>Through our interactive visualization, we invite you to explore the impact of condo conversions on your community.<br> <newline></newline> On the map, click a Boston or Cambridge zip code to see the locations of condo conversions (starting from 2015) in the region:</blockquote> <div class="parent-container svelte-11jnsqs"><!> <!> <!></div> <!>',!0);function Wt(r,c){M(c,!1);const n={};K(n);const o=()=>et(f,"$zipcode",n);let f=ft("");const g=["02140","02139","02142","02141","02138"];j();var x=w(r,!0,Dt);Q(t=>{G.title="Condo Conversions in Greater Boston "});var m=D(x),s=_(_(m,!0)),h=L(s),v=_(_(h,!0)),b=_(_(v,!0)),d=_(_(s,!0));Ct(h,{get zipcode(){return o()},set zipcode(t){tt(f,t)}}),B(v,{children:(t,u)=>{var l=z(t,!0,kt);k(t,l)},$$slots:{viz:(t,u)=>{var l=z(t,!0,zt),p=L(l);dt(p,{get query(){return o()}}),k(t,l)}}}),B(b,{children:(t,u)=>{var l=z(t,!0,Lt);k(t,l)},$$slots:{viz:(t,u)=>{var l=z(t,!0,St),p=L(l);ut(p,{get query(){return o()}}),k(t,l)}}}),N(d,()=>o()!==""&&g.indexOf(o())!==-1,t=>{var u=w(t,!0,qt);P(t,u)},t=>{var u=w(t,!0,Ft),l=D(u),p=_(_(l,!0));B(l,{children:(a,e)=>{var i=z(a,!0,Pt);k(a,i)},$$slots:{viz:(a,e)=>{var i=z(a,!0,wt),S=L(i);bt(S,{get query(){return o()}}),k(a,i)}}}),B(p,{children:(a,e)=>{var i=z(a,!0,Bt);k(a,i)},$$slots:{viz:(a,e)=>{var i=z(a,!0,Tt),S=L(i);pt(S,{get query(){return o()}}),k(a,i)}}}),P(t,u)}),P(r,x),A()}export{Wt as component};
