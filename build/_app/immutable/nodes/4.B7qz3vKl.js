import{i as X,k as Y,U as B,c as tt,m as et,b as nt,l as rt,d as L,o as it,e as ot}from"../chunks/disclose-version.BW5RF7my.js";import{p as at,a as st,s as ct,g as S}from"../chunks/runtime.DoKzdPu0.js";import{o as ut}from"../chunks/main-client.CkCemnIN.js";import{o as ft}from"../chunks/transform.s-_yf9sf.js";import{c as lt}from"../chunks/colors.Cc3OSVma.js";import{c as P}from"../chunks/dsv.XhNTmijJ.js";import{s as A}from"../chunks/select.vMFQoPFd.js";function ht(t){var n=0,e=t.children,r=e&&e.length;if(!r)n=1;else for(;--r>=0;)n+=e[r].value;t.value=n}function pt(){return this.eachAfter(ht)}function dt(t,n){let e=-1;for(const r of this)t.call(n,r,++e,this);return this}function xt(t,n){for(var e=this,r=[e],i,o,a=-1;e=r.pop();)if(t.call(n,e,++a,this),i=e.children)for(o=i.length-1;o>=0;--o)r.push(i[o]);return this}function mt(t,n){for(var e=this,r=[e],i=[],o,a,c,s=-1;e=r.pop();)if(i.push(e),o=e.children)for(a=0,c=o.length;a<c;++a)r.push(o[a]);for(;e=i.pop();)t.call(n,e,++s,this);return this}function vt(t,n){let e=-1;for(const r of this)if(t.call(n,r,++e,this))return r}function yt(t){return this.eachAfter(function(n){for(var e=+t(n.data)||0,r=n.children,i=r&&r.length;--i>=0;)e+=r[i].value;n.value=e})}function gt(t){return this.eachBefore(function(n){n.children&&n.children.sort(t)})}function _t(t){for(var n=this,e=wt(n,t),r=[n];n!==e;)n=n.parent,r.push(n);for(var i=r.length;t!==e;)r.splice(i,0,t),t=t.parent;return r}function wt(t,n){if(t===n)return t;var e=t.ancestors(),r=n.ancestors(),i=null;for(t=e.pop(),n=r.pop();t===n;)i=t,t=e.pop(),n=r.pop();return i}function At(){for(var t=this,n=[t];t=t.parent;)n.push(t);return n}function kt(){return Array.from(this)}function Mt(){var t=[];return this.eachBefore(function(n){n.children||t.push(n)}),t}function Ct(){var t=this,n=[];return t.each(function(e){e!==t&&n.push({source:e.parent,target:e})}),n}function*bt(){var t=this,n,e=[t],r,i,o;do for(n=e.reverse(),e=[];t=n.pop();)if(yield t,r=t.children)for(i=0,o=r.length;i<o;++i)e.push(r[i]);while(e.length)}function j(t,n){t instanceof Map?(t=[void 0,t],n===void 0&&(n=qt)):n===void 0&&(n=zt);for(var e=new N(t),r,i=[e],o,a,c,s;r=i.pop();)if((a=n(r.data))&&(s=(a=Array.from(a)).length))for(r.children=a,c=s-1;c>=0;--c)i.push(o=a[c]=new N(a[c])),o.parent=r,o.depth=r.depth+1;return e.eachBefore(jt)}function Dt(){return j(this).eachBefore(Et)}function zt(t){return t.children}function qt(t){return Array.isArray(t)?t[1]:null}function Et(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function jt(t){var n=0;do t.height=n;while((t=t.parent)&&t.height<++n)}function N(t){this.data=t,this.depth=this.height=0,this.parent=null}N.prototype=j.prototype={constructor:N,count:pt,each:dt,eachAfter:mt,eachBefore:xt,find:vt,sum:yt,sort:gt,path:_t,ancestors:At,descendants:kt,leaves:Mt,links:Ct,copy:Dt,[Symbol.iterator]:bt};function Nt(t){return t==null?null:Rt(t)}function Rt(t){if(typeof t!="function")throw new Error;return t}function $(){return 0}function Zt(t){return function(){return t}}const St=1664525,Ut=1013904223,F=4294967296;function Wt(){let t=1;return()=>(t=(St*t+Ut)%F)/F}function Ht(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Lt(t,n){let e=t.length,r,i;for(;e;)i=n()*e--|0,r=t[e],t[e]=t[i],t[i]=r;return t}function Pt(t,n){for(var e=0,r=(t=Lt(Array.from(t),n)).length,i=[],o,a;e<r;)o=t[e],a&&T(a,o)?++e:(a=Ft(i=$t(i,o)),e=0);return a}function $t(t,n){var e,r;if(U(n,t))return[n];for(e=0;e<t.length;++e)if(q(n,t[e])&&U(k(t[e],n),t))return[t[e],n];for(e=0;e<t.length-1;++e)for(r=e+1;r<t.length;++r)if(q(k(t[e],t[r]),n)&&q(k(t[e],n),t[r])&&q(k(t[r],n),t[e])&&U(V(t[e],t[r],n),t))return[t[e],t[r],n];throw new Error}function q(t,n){var e=t.r-n.r,r=n.x-t.x,i=n.y-t.y;return e<0||e*e<r*r+i*i}function T(t,n){var e=t.r-n.r+Math.max(t.r,n.r,1)*1e-9,r=n.x-t.x,i=n.y-t.y;return e>0&&e*e>r*r+i*i}function U(t,n){for(var e=0;e<n.length;++e)if(!T(t,n[e]))return!1;return!0}function Ft(t){switch(t.length){case 1:return Gt(t[0]);case 2:return k(t[0],t[1]);case 3:return V(t[0],t[1],t[2])}}function Gt(t){return{x:t.x,y:t.y,r:t.r}}function k(t,n){var e=t.x,r=t.y,i=t.r,o=n.x,a=n.y,c=n.r,s=o-e,f=a-r,l=c-i,p=Math.sqrt(s*s+f*f);return{x:(e+o+s/p*l)/2,y:(r+a+f/p*l)/2,r:(p+i+c)/2}}function V(t,n,e){var r=t.x,i=t.y,o=t.r,a=n.x,c=n.y,s=n.r,f=e.x,l=e.y,p=e.r,x=r-a,d=r-f,m=i-c,y=i-l,g=s-o,v=p-o,u=r*r+i*i-o*o,w=u-a*a-c*c+s*s,h=u-f*f-l*l+p*p,_=d*m-x*y,M=(m*h-y*w)/(_*2)-r,C=(y*g-m*v)/_,b=(d*w-x*h)/(_*2)-i,D=(x*v-d*g)/_,R=C*C+D*D-1,z=2*(o+M*C+b*D),H=M*M+b*b-o*o,Z=-(Math.abs(R)>1e-6?(z+Math.sqrt(z*z-4*R*H))/(2*R):H/z);return{x:r+M+C*Z,y:i+b+D*Z,r:Z}}function G(t,n,e){var r=t.x-n.x,i,o,a=t.y-n.y,c,s,f=r*r+a*a;f?(o=n.r+e.r,o*=o,s=t.r+e.r,s*=s,o>s?(i=(f+s-o)/(2*f),c=Math.sqrt(Math.max(0,s/f-i*i)),e.x=t.x-i*r-c*a,e.y=t.y-i*a+c*r):(i=(f+o-s)/(2*f),c=Math.sqrt(Math.max(0,o/f-i*i)),e.x=n.x+i*r-c*a,e.y=n.y+i*a+c*r)):(e.x=n.x+e.r,e.y=n.y)}function I(t,n){var e=t.r+n.r-1e-6,r=n.x-t.x,i=n.y-t.y;return e>0&&e*e>r*r+i*i}function J(t){var n=t._,e=t.next._,r=n.r+e.r,i=(n.x*e.r+e.x*n.r)/r,o=(n.y*e.r+e.y*n.r)/r;return i*i+o*o}function E(t){this._=t,this.next=null,this.previous=null}function It(t,n){if(!(o=(t=Ht(t)).length))return 0;var e,r,i,o,a,c,s,f,l,p,x;if(e=t[0],e.x=0,e.y=0,!(o>1))return e.r;if(r=t[1],e.x=-r.r,r.x=e.r,r.y=0,!(o>2))return e.r+r.r;G(r,e,i=t[2]),e=new E(e),r=new E(r),i=new E(i),e.next=i.previous=r,r.next=e.previous=i,i.next=r.previous=e;t:for(s=3;s<o;++s){G(e._,r._,i=t[s]),i=new E(i),f=r.next,l=e.previous,p=r._.r,x=e._.r;do if(p<=x){if(I(f._,i._)){r=f,e.next=r,r.previous=e,--s;continue t}p+=f._.r,f=f.next}else{if(I(l._,i._)){e=l,e.next=r,r.previous=e,--s;continue t}x+=l._.r,l=l.previous}while(f!==l.next);for(i.previous=e,i.next=r,e.next=r.previous=r=i,a=J(e);(i=i.next)!==r;)(c=J(i))<a&&(e=i,a=c);r=e.next}for(e=[r._],i=r;(i=i.next)!==r;)e.push(i._);for(i=Pt(e,n),s=0;s<o;++s)e=t[s],e.x-=i.x,e.y-=i.y;return i.r}function Jt(t){return Math.sqrt(t.value)}function K(){var t=null,n=1,e=1,r=$;function i(o){const a=Wt();return o.x=n/2,o.y=e/2,t?o.eachBefore(O(t)).eachAfter(W(r,.5,a)).eachBefore(Q(1)):o.eachBefore(O(Jt)).eachAfter(W($,1,a)).eachAfter(W(r,o.r/Math.min(n,e),a)).eachBefore(Q(Math.min(n,e)/(2*o.r))),o}return i.radius=function(o){return arguments.length?(t=Nt(o),i):t},i.size=function(o){return arguments.length?(n=+o[0],e=+o[1],i):[n,e]},i.padding=function(o){return arguments.length?(r=typeof o=="function"?o:Zt(+o),i):r},i}function O(t){return function(n){n.children||(n.r=Math.max(0,+t(n)||0))}}function W(t,n,e){return function(r){if(i=r.children){var i,o,a=i.length,c=t(r)*n||0,s;if(c)for(o=0;o<a;++o)i[o].r+=c;if(s=It(i,e),c)for(o=0;o<a;++o)i[o].r-=c;r.r=s+c}}}function Q(t){return function(n){var e=n.parent;n.r*=t,e&&(n.x=e.x+t*n.x,n.y=e.y+t*n.y)}}const Kt=lt("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");var Ot=ot('<input type="text" placeholder="Enter Zipcode"> <button>Update Chart</button> <svg></svg> <div class="legend"></div>',!0);function ee(t,n){st(n,!1);let e=et(""),r,i=960,o=500;const a={top:20,right:20,bottom:30,left:40},c=ft(Kt);async function s(d){const m=await P("complaints_count_zipcode.csv");m.columns=m.columns.map(h=>h.trim().replace(/[^\x20-\x7E]+/g,""));const y=m.filter(h=>h["Zip Code"]===d),g=K().size([i-a.left-a.right,o-a.top-a.bottom]).padding(10),v=j({children:y}).sum(h=>+h["Count of Description"]),u=g(v).descendants();r=A("svg").attr("width",i).attr("height",o).append("g").attr("transform",`translate(${a.left}, ${a.top})`),r.selectAll("circle").data(u.slice(1)).enter().append("circle").attr("cx",h=>h.x).attr("cy",h=>h.y).attr("r",h=>h.r).attr("fill",h=>c(h.data["Description (group)"])).attr("opacity",.7).on("mouseover",function(h,_){A(this).append("title").text(_.data["Description (group)"])}).on("mouseout",function(){A(this).select("title").remove()}),console.log(c.domain())}function f(){S(e)?P("complaints_count_zipcode.csv").then(d=>{d.columns=d.columns.map(u=>u.trim().replace(/[^\x20-\x7E]+/g,""));const m=d.filter(u=>u["Zip Code"]===S(e)),y=j({children:m}).sum(u=>+u["Count of Description"]),g=K().size([i-a.left-a.right,o-a.top-a.bottom]).padding(10)(y).descendants(),v=r.selectAll("circle").data(g.slice(1));v.transition().duration(750).attr("cx",u=>u.x).attr("cy",u=>u.y).attr("r",u=>u.r),v.enter().append("circle").attr("cx",u=>u.x).attr("cy",u=>u.y).attr("r",u=>u.r).attr("fill",u=>c(u.data["Description (group)"])).attr("opacity",.7).transition().duration(750).attr("r",u=>u.r),v.exit().remove(),v.on("mouseover",function(u,w){A(this).append("title").text(w.data["Description (group)"])}).on("mouseout",function(){A(this).select("title").remove()})}):alert("Please enter a zipcode.")}ut(()=>{s("02108")}),X();var l=it(t,!0,Ot),p=nt(l);rt(p);var x=L(L(p,!0));Y(p,()=>S(e),d=>ct(e,d)),B("click",x,f,!1),tt(t,l),at()}export{ee as component};
